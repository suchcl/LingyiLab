### 微信小程序中获取用户信息

#### wx.getUserProfile

参考链接：https://developers.weixin.qq.com/community/develop/doc/00022c683e8a80b29bed2142b56c01?blockType=1

小程序中推荐使用wx.getUserProfile获取用户基本信息，基本信息包括用户昵称、用户头像。

> 在开发环境上，除了用户的昵称、头像外，还可以返回用户所属国家、所属城市、性别。

小程序可以获取到的用户信息有：昵称(string nickName)、用户头像图片的url(string avatarUrl)

#### wx.login

微信现在推广使用wx.login接口直接获取用户的openID和unionID，实现微信身份的登录，支持开发者在多个小程序或其他应用中关联同一微信用户。

之前在微信小程序平台中，有些场景需要用到用户昵称、用户头像，微信平台为了便于开发者获得用户昵称和头像等基本信息，提供了wx.getUserProfile()接口，但是在实际的使用过程中，出现了该接口被滥用的情况，在用户拒绝授权使用用户昵称和头像的情况下，那么就不允许使用小程序的相关功能，这一点严重影响了用户对小程序的使用体验。为了减少出现诸如此类不合理的强迫授权的情况，微信平台对小程序作出了一些调整：

自2022年10月25日24时，即从2022年10月26日(可以理解为该时间点为生效期)开始：

1. 自生效期起，小程序通过wx.getUserProfile()接口将被收回：生效期后发布的小程序，小程序通过wx.getUserProfile()获取都的用户头像将统一返回默认的灰色头像(默认的用户头像如下图所示)，昵称将统一返回“微信用户”。

![微信小程序默认的灰色用户头像](./images/img-1.png)

> 生效期以前发布的小程序不受影响，还可以通过wx.getUserProfile()获取到用户头像和昵称，但是如果要进行版本更新，则需要进行版本适配，即需要展示用户昵称和头像的地方需要使用的新的方式来获取并展示出来。

2. 自生效期起，插件通过wx.getUserInfo()接口获取用户昵称和头像的能力将被收回：生效期后发布的插件版本，插件通过wx.getUserInfo()接口获取的用户头像，将统一返回默认的灰色头像(默认的灰色头像如下图所示)，用户昵称将统一返回“微信用户”.

![微信小程序默认的灰色用户头像](./images/img-1.png)

> 生效期以前发布的插件，可以通过wx.getUserInfo()接口正常的获取用户头像和昵称，但是在生效期后如果要更新插件，那么就需要做该部分功能的适配。

3. 头像昵称天填写能力支持获取用户头像昵称：如果业务需要获取用户的头像、昵称，则可以通过“头像昵称填写能力”来实现。

当需要展示用户头像、昵称信息时，如果不想用户做登录那么重的动作，在这里让用户补充信息的方式，也可以作为一种方式去实现。

> 虽然小程序给我们提供了这种能力，但我个人并不认为这是一种优秀的问题解决方案，因为这让用户修改了自己的头像和昵称，很多人是有逆反心理对，我就比较反感这样的操作。这样的操作，我认为和强制让我授权获取头像和昵称的方式，没有什么两样，都是比较让人讨厌的行为。

> 像互联网产品，尤其是现在有那么多可替代产品的情况下，产品的用户使用体验不友好，我的第一个操作就是直接删掉。

> 头像昵称填写能力，现在在还存在一些兼容性的问题，现在小程序平台又让继续使用wx.getUserProfile的方式来获取用户头像和昵称了

参考链接：https://developers.weixin.qq.com/community/develop/doc/00022c683e8a80b29bed2142b56c01?blockType=1

### 现在可用的获取用户头像和昵称的方式

由于官方期望的不让用户频繁授权而期望回收wx.getUserProfile接口，以及通过让用户补充头像和昵称的方式去获取用户的头像、昵称的方案，由于现在在技术上还存在一些兼容性的问题，现在还能继续通过wx.getUserProfile()来获取用户头像和昵称。(2022.11.9)

现在还暂时可以使用wx.getUserProfile()接口获取用户头像、昵称、性别、地区信息，但是开发者每次通过该接口获取用户信息时都需要用户授权确认，否则无法正常获取到用户信息。 

wx.getUserProfile()接口的从2021.4.28上下，到计划的今年的11月初废弃，仅仅使用了1年半的时间，感觉微信的api设计的及其的不稳定，api改变的太频繁。虽然现在该接口还可以正常使用，能够通过该接口获取用户头像和昵称信息，但这是在填写用户头像、昵称功能存在兼容性的问题基础上的，如果填写用户头像昵称功能好用的时间是不是就是该接口都被废弃的时间。

