### 微信小程序中获取用户信息

#### wx.getUserProfile

参考链接：https://developers.weixin.qq.com/community/develop/doc/00022c683e8a80b29bed2142b56c01?blockType=1

小程序中推荐使用wx.getUserProfile获取用户基本信息，基本信息包括用户昵称、用户头像。

> 在开发环境上，除了用户的昵称、头像外，还可以返回用户所属国家、所属城市、性别。

小程序可以获取到的用户信息有：昵称(string nickName)、用户头像图片的url(string avatarUrl)

#### wx.login

微信现在推广使用wx.login接口直接获取用户的openID和unionID，实现微信身份的登录，支持开发者在多个小程序或其他应用中关联同一微信用户。

之前在微信小程序平台中，有些场景需要用到用户昵称、用户头像，微信平台为了便于开发者获得用户昵称和头像等基本信息，提供了wx.getUserProfile()接口，但是在实际的使用过程中，出现了该接口被滥用的情况，在用户拒绝授权使用用户昵称和头像的情况下，那么就不允许使用小程序的相关功能，这一点严重影响了用户对小程序的使用体验。为了减少出现诸如此类不合理的强迫授权的情况，微信平台对小程序作出了一些调整：

自2022年10月25日24时，即从2022年10月26日(可以理解为该时间点为生效期)开始：

1. 自生效期起，小程序通过wx.getUserProfile()接口将被收回：生效期后发布的小程序，小程序通过wx.getUserProfile()获取都的用户头像将统一返回默认的灰色头像(默认的用户头像如下图所示)，昵称将统一返回“微信用户”。

![微信小程序默认的灰色用户头像](./images/img-1.png)

> 生效期以前发布的小程序不受影响，还可以通过wx.getUserProfile()获取到用户头像和昵称，但是如果要进行版本更新，则需要进行版本适配，即需要展示用户昵称和头像的地方需要使用的新的方式来获取并展示出来。

2. 自生效期起，插件通过wx.getUserInfo()接口获取用户昵称和头像的能力将被收回：生效期后发布的插件版本，插件通过wx.getUserInfo()接口获取的用户头像，将统一返回默认的灰色头像(默认的灰色头像如下图所示)，用户昵称将统一返回“微信用户”.

![微信小程序默认的灰色用户头像](./images/img-1.png)

> 生效期以前发布的插件，可以通过wx.getUserInfo()接口正常的获取用户头像和昵称，但是在生效期后如果要更新插件，那么就需要做该部分功能的适配。