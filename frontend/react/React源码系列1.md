参考链接：https://juejin.cn/post/7199822364548071482

## 1. 设计理念&架构

React的设计理念是快速响应、解决两个方面的问题：

1. IO瓶颈：发送了网络请求以后，由于需要等待数据返回才能进行下一步操作导致的不能快速响应的问题；

2. CPU瓶颈：当遇到大计算量的操作或设备性能不足使页面掉帧，导致页面渲染卡顿；

当前，主流浏览器的刷新频率是60Hz，就是每(1000ms/60Hz)16.6ms浏览器刷新一次.那么浏览器在这16.6ms中，需要做很多的事情，如执行js脚本、样式布局、页面绘制等等，那么也就是说，js脚本的执行和样式布局、页面绘制是依次顺序执行的、是互斥的，那么如果js脚本执行的时间长了的话，那么就会造成样式布局、页面绘制的时间不够，那么就会导致页面掉帧，感觉有卡顿现象。

有了这个问题，有什么办法可以解决呢？

在日常的开发中，我们遇到了大数据量的渲染是怎么处理的呢？通常我们应该会想到任务分割，就是将大量的数据分为多个任务去处理，并且能够控制任务的执行、中断等一些操作，这样我们就能够在一些优先级高的任务进来的时候可以控制大数据量的任务让出执行权，等其他临时加进来的高优先级的任务执行完成后再恢复大数据量计算任务的执行。所以这种方案的关键点，就是实现一套可控的中断方案。

React的实现，主要包含3个方面的重点内容：

- 任务分割；

- 异步执行；

- 让出执行权组成；

1. Fiber:在React16之前React采用的是递归调用，递归调用有一个问题，就是调用一旦开始，就没有办法停止，直到渲染出完整的树结构。也就是说会造成主线程被持续占用，造成的后果就是主线程上的布局、动画等周期性任务就无法得到及时处理，造成视觉上的卡顿，影响了用户体验。React16之后使用增量渲染方式(把渲染任务拆分成多个块，匀到多个帧)，把工作分解成小单元，在完成了每个小的单元之后，如果有其他的高优先级的任务需要执行，那么我们就让浏览器中断渲染，去执行其他的高优先级任务，这也就是Fiber。

2. Scheduler(调度):有了Fiber，我们就可以使用浏览器的时间切片去异步执行这些Fiber的工作单元。使用时间切片，将同步更新变更为可中断的异步更新，也就是在浏览器每一帧的时间中，预留一些时间给js线程，React利用这部分时间更新组件，预留的初始时间是5ms。当预留时间不够用时，React将线程控制权交还给浏览器使其有时间渲染UI，React则等待下一帧时间来继续被中断的工作。

3. Lane(优先级):有了异步调度，我们还需要管理各个任务的优先级，让高优先级的任务优先执行，各个Fiber工作单元还能比较优先级，相同优先级的任务可以一起更新。

## 2. 虚拟DOM与价值