我没有接触过react15，类式组件也是仅仅看文档学习过一点，没有实际上过项目，对react16.8之前的版本了解的不是很多，看到大佬们分析之前各个版本的进化，简单做个记录。

本文的主要内容，其实是通过react源码分析react的进化，由于主要是针对react15做的对比分析，权且记录为为什么react15为什么需要进化吧。

### react15为什么需要进化？

主要是因为react15有两大弊端：

1. 渲染阻塞

2. 没有办法合并异步函数里面的setState

#### 同步渲染阻塞主线程

react15，从setState到DOM节点渲染到页面上，整个过程是同步的，因此，如果其中的某个环节消耗的时间比较长，就会阻塞主线程。

js的执行是单线程的，js引擎线程与浏览器的其他线程互斥，如果js线程阻塞，其他线程如GUI渲染线程、事件线程、异步HTTP线程等都会被阻塞，都会被挂起，同时用户触发的浏览器事件没有响应、造成页面卡顿现象。

**那么react15在什么样的场景下会造成阻塞呢？**

react15采用的是树形结构的虚拟DOM树，使用递归的方式进行节点遍历，递归就意味着虚拟DOM的构建是一个同步的过程，只要开始遍历开始了就没有办法中断，且DOM层级越深，节点数量越多，diff流程占用的js线程的时间就越长。

#### 无法合并异步函数里面的setState

react15下的setState的合并更新机制，是以函数为单位，将函数内同步执行的setState合并(异步执行的setState没有办法被合并)。

### Fiber架构下的react提升

在react16.8版本后，react重构了整个架构，目的是为了实现异步可中断更新。

回顾下react15中的两大痛点：

1. 同步渲染阻塞

2. 无法合并异步函数里面的setState

那么react16.x重构架构的重要目标就是为了解决这2个问题。

#### 改变树形结构和节点遍历方式