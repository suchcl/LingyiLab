### 并发

在软件开发领域，或者在计算机领域内，经常听到有人说什么高并发，那么究竟什么是并发呢？高并发又指什么呢？达到什么条件才算是高并发呢？

**并发**

在计算机领域内，并发(concurrency)是指在同一时间段内，多个任务或者事件同时发生或者交替进行。需要注意的是，并发并不意味着这些任务是真正意义上的“同时执行”，在单处理器系统中，实际上是通过任务切换快速的在不同任务之间轮换执行，给人一种“同时进行”的感觉；而在多处理器系统中，任务可能会真正地同时在不同的处理器核心上执行的。

**单核处理器的并发示例：**可以想象有一个厨师(相当于单核处理器)在一个炉灶(代表计算机的处理资源)上做菜。他要做两道菜，一道是炒土豆丝，一道是西红柿炒鸡蛋。他先切土豆丝(注意是只是开始了切，并没有说切好、切完)，切了一会后，停下切土豆丝的动作，开始打鸡蛋、切西红柿，然后又回来继续切土豆。如此在两个任务之间来回切换，交替进行，最终完成两道菜。这就是单核处理器下的并发，通过快速切换任务来营造多个任务同时进行的效果。

**多核处理器的并发示例：**假设一个厨师有两个炉灶(相当于多核处理器)，还是那个厨师，他可以在一个炉灶上炒土豆丝，同时在另一个炉灶上做西红柿炒鸡蛋。这就是多核处理器的并发，多个任务可以在不同的处理核心上真正的同时执行。

### 并发在编程中的应用场景和优势

1. 提高资源利用率：以服务器处理客户端请求为例。一个web服务器可能需要同时处理多个用户的HTTP请求。通过并发编程，服务器可以在同一时间或者接近同一时间处理多个请求，而不是一次只处理一个请求。这样可以充分的利用好CPU、内存等资源，提高服务器的整体性能和响应速度。

2. 增强程序的响应性：在图形用户界面(GUI)应用程序中，并发非常重要。例如当点击一个按钮来保存文件时，程序可以在后台启动保存文件的操作(这个操作可能比较耗时，如将文件上传到云端)，同时用户需要在界面上进行其他操作，如打开新的文件或者调整窗口的大小等。这种并发处理让程序对用户来说感觉上更加灵活和高效。

### 并发和并行的区别

    并行和并发都涉及到了多个任务的处理，但是它们有一定的区别。“并行”强调多个任务真正的同时执行，需要有多个处理核心(多核处理器)单元来支持。例如在一个有4个CPU的计算机上，4个任务可以同时在这4个核心上运行，这是并行。而并发更侧重于任务在逻辑上的同时进行，即使在单核处理器上，通过任务切换机制也可以实现并发。例如在单核CPU上通过时间片轮换方式处理多个任务，使它们看起来好像是同时进行的，这是并发。


### 任务的交替机制是什么？以及任务交替的实现方式是什么？

#### 任务交替机制

- 时间片轮转(Round-Robin)机制

- 基于事件驱动的机制

    在这种机制下，任务的执行是由事件触发的。例如当一个网络数据包到达(这是一个事件)时，负责处理网络通信的任务会被唤醒并被执行；当用户在图形界面上点击了一个按钮(这也是一个事件)，对应的按钮点击处理任务会被执行；当这些任务执行完毕或者等待新的事件时，CPU就可以去执行其他任务。这种方式适合处理那些对响应速度要求高、并且事件发生频率不固定的场景，如GUI应用程序和网络服务器。

#### 任务交替的实现方式

### 常见问题

1. 既然并发没有实现真正的多任务的同时执行，只是任务的交替执行，那么它是怎么提升的效率呢？是不是对用户的一种欺骗呢？

    并发虽然不是多任务的同时进行，但是确实可以提高系统的执行效率，主要体现在以下几个方面。

    **资源利用率方面**

- 充分利用空闲时间

    在单处理器的系统中，当一个任务正在等待I/O操作(如读取硬盘数据、等待网络响应)完成时，它会处于阻塞状态，此时的CPU处于空闲状态。这个时候通过并发机制，调度程序可以让CPU切换去执行其他就绪的任务，而不是让CPU闲置。例如在一个简单的Web服务器中，当服务器正在等待从数据库读取用户信息时(这是一个I/O操作)，它可以利用这段时间去处理其他用户的HTTP请求，从而提高CPU的利用效率。

- 多任务环境下的整体性能提升

    在现代计算机系统中，通常会同时运行多个程序或进程。并发使得这些程序能够共享CPU资源，在宏观上提升了系统的整体性能。比如一个用户同时打开了浏览器、文字处理器和音乐播放器的场景下，通过并发，操作系统可以合理分配CPU时间给这3个程序，让用户感觉3个程序都在正常运行，而不是一个程序独占CPU资源，其他程序无法响应。

    **响应时间方面**

- 改善用户体验

    对于一些交互式应用程序，并发能够显著改善用户体验。以图形用户界面(GUI)应用为例，当用户执行一个可能需要较长时间的操作(如保存一个大型文件)时，并发机制可以保存文件的任务在后台运行，同时用户仍然可以在界面上进行其他操作，如滚动文档、选择菜单选项等。

- 缩短任务的平均等待时间

    在多任务并发环境下，任务的调度策略可以使得每个任务的平均等待时间缩短。如采用优先级调度和时间片轮转相结合的策略，高优先级的任务可以更快的得到执行，而每个任务在时间片轮转机制下也不会长时间等待。这就像在一个餐厅中，服务员(相当于调度程序)会有限服务VIP客户(高优先级任务)，同时也会保证每个普通顾客(普通任务)都能在合理的时间内得到服务，从而提高整个餐厅(系统)的服务效率。

    **系统扩展性方面**

- 便于利用多核处理器

    随着技术的发展，多核处理器已经非常普及。并发编程模型可以很方便的扩展到多核环境中，真正实现并行执行，从而进一步提高程序的执行效率。如一个原本在单核上通过并发机制交替执行的多任务程序，迁移到多核处理器上以后，可以让不同的任务分配到不同的核心上同时执行，从而大大的缩短了程序的整体运行时间。

- 应对高并发请求场景

    在服务端应用中，如web服务器、数据库服务器等，会面临大量的并发请求。通过并发编程技术，服务器可以更好的处理这些请求。如采用多线程或多进程并发模型，服务器可以为每个请求分配一个线程或进程来处理，当请求数量增加时，可以通过增加线程/进程数量(在一定范围内)来提高服务器的处理能力，而不是只能逐个处理请求。这是实实在在的提高了服务器应对高并发场景的效率。

2. 哪些情况下适合并发编程，前端中怎么实现并发编程？



3. 什么是并行？