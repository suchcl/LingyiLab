## 首屏渲染性能优化

### 1.首屏渲染

首屏渲染，指的是浏览器从响应用户输入url到首屏内容渲染完成的时间，此时整个网页的内容不一定渲染完成，但是当前视口范围内的内容是已经渲染完成的。

首屏加载性能，可以说是用户体验部分最重要的环节。

**首屏时间的计算**

可以通过使用performance或者DOMContentLoad来计算首屏加载时间。

### 2.加载慢的原因

加载慢的原因，无论是首屏，还是其他模块，都无非是以下几个原因：

1. 网络原因
2. 文件质量过大
3. HTTP请求使用的不合理
4. 发生了内容阻塞

### 3.解决方案

已经分析出来原因了，就对症下药就可以了。

1. 减小入口文件（文件）的质量
2. 缓存静态资源到本地
3. UI框架按需加载
4. 图片资源的压缩、延迟加载、懒加载
5. 组件的重复打包
6. 开启GZip压缩
7. 使用SSR

#### 3.1减小入口文件（文件）的质量

路由懒加载，结合Vue的异步组件和webpack的代码分割功能，可以轻松的实现路由的懒加载，把不同路由对应的代码打包成不同的代码块，待路由被请求时，单独打包路由以及对应的组件，使得入口文件变小，加载速度提升；

在路由配置的时候，采用动态加载路由的配置方式

```javascript
  {
    path: "/user",
    component: () => import("../components/user.vue"), // 只有请求了这个路由后，才去加载这个组件
    meta: {
      title: "用户列表"
    }
  },
```

这样就只有在加载指定的路由时，才会加载对应的组件。

#### 3.2 缓存静态资源到本地

服务端返回的数据可以采用http缓存，也可以采用Service Worker离线缓存

客户端，也可以合理的使用localStorage缓存

在使用缓存的时候，根据实际场景判断是否可以直接使用本地数据，如果可以，就可以大大的缩短请求的消耗时间

#### 3.3 UI框架按需加载

在C端项目应该会少一些，我当前做过的C端项目很少直接使用一个开源的UI框架，但是B端的项目，基本会直接使用开源的UI框架，如ElementUI、AntDesign等。

基本上所有的UI框架都实现了按需加载，合理的导入、引用需要的组件，按需加载、引用必要的组件。

#### 3.4 图片资源的压缩、延迟加载、懒加载

懒加载

icon图标的合理使用：base64、雪碧图、字体图标

可替换图片资源：压缩、CDN

#### 3.5 组件的重复打包

把使用频率高的资源、组件，在打包工具中进行配置，避免重复打包，如使用次数超过3次以上的组件，配置成单独打包、非重复打包

#### 3.6 开启GZip压缩

一般情况下，静态资源服务器会打开gzip压缩的，但是还是在前端项目打包的时候，就直接打好包，可以减少服务器端监测时间

#### 3.7 使用SSR

这个就会麻烦一些了，主要就是在页面渲染时，在服务器端就已经完成DOM结构的拼接，浏览器端只是做一个渲染的动作，不用在去解析代码耗时

### 4. 小结

页面性能的优化，主要就是加载资源的优化和页面渲染的优化，抓住这2个核心的点，去拆解优化就可以了。